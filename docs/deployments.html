<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Application Deployments</title>
    <link rel="icon" type="image/x-icon" href="/marathon/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/docs/networking.html">
                    Networking
                </a>
            </li>
            <li>
                <a href="/marathon/docs/pods.html">
                    Pods
                </a>
            </li>
            <li>
                <a href="/marathon/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/native-docker.html">
                    Provisioning Containers
                </a>
            </li>
            <li>
                <a href="/marathon/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
            <li>
                <a href="/marathon/docs/task-handling.html">
                    Task Handling
                </a>
            </li>
            <li>
                <a href="/marathon/docs/configure-task-handling.html">
                    Task Handling Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/docs/secrets.html">
                    Secret Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/docs/unreachable.html">
                    Unreachable Strategy
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/docs/backup-restore.html">
                    Backup and Restore
                </a>
            </li>
            <li>
                <a href="/marathon/docs/data-migration.html">
                    Data Migration
                </a>
            </li>
            <li>
                <a href="/marathon/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/docs/maintenance-mode.html">
                    Maintenance mode
                </a>
            </li>
        </ul>

        <h5>Upgrading</h5>
        <ul class="list-unstyled">
          <li>
              <a href="/marathon/docs/upgrade/index.html">
                  Upgrading to a new Version
              </a>
          </li>
          <li>
              <a href="/marathon/docs/upgrade/network-api-for-apps.html">
                  Migrating Apps to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/docs/upgrade/network-api-migration.html">
                  Migrating Tools to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/docs/upgrade/versioning.html">
                  Versioning
              </a>
          </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/waiting.html">
                   Stuck App or Pod Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
            <li>
                <a href="/marathon/docs/cfs.html">
                    Slow Docker apps and deployments
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/api-console/index.html">REST API Reference</a>
        </li>
        </ul>
        <h5>Docs for Previous Versions</h5>
        <ul class="list-unstyled">
            
            <li><a href="/marathon/1.6/docs">Version 1.6.x</a></li>
            
            <li><a href="/marathon/1.5/docs">Version 1.5.x</a></li>
            
            <li><a href="/marathon/1.4/docs">Version 1.4.x</a></li>
            
        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="application-deployments">Application Deployments</h1>

<p>Every change in the definition of applications or groups in Marathon is performed as a deployment.
A deployment is a set of actions, that can:</p>

<ul>
  <li>Start/Stop one or more applications.</li>
  <li>Upgrade one or more applications.</li>
  <li>Scale one or more applications.</li>
</ul>

<p>Deployments take time and are not instantly available. A deployment is considered active in Marathon until it has finished successfully. Marathon removes deployments after they have completed successfully.</p>

<p>You can perform multiple deployments at the same time as long as one application is changed only by one deployment.
If you request a deployment that tries to change an application that is already being changed by another active deployment, Marathon will reject the new deployment.</p>

<h2 id="dependencies">Dependencies</h2>

<p>Applications without dependencies can be deployed in any order without restriction.
If there are dependencies between applications, then the deployment actions will be performed in the order the dependencies require.</p>

<p class="text-center">
  <img src="/marathon/img/dependency.png" width="645" height="241" alt="" />
</p>

<p>In the example above, the application <em>app</em> is dependent on the application <em>db</em>.</p>

<ul>
  <li><strong>Starting :</strong> If <em>db</em> and <em>app</em> are added to the system, <em>db</em> is started first and then <em>app</em>.</li>
  <li><strong>Stopping :</strong> If <em>db</em> and <em>app</em> are removed from the system, <em>app</em> is removed first and then <em>db</em>.</li>
  <li><strong>Upgrade :</strong> See the Rolling Restart section.</li>
  <li><strong>Scaling :</strong> If <em>db</em> and <em>app</em> get scaled, <em>db</em> is scaled first and then <em>app</em>.</li>
</ul>

<h2 id="rolling-restarts">Rolling Restarts</h2>

<p>Marathon allows you to perform rolling restarts to deploy new versions of applications. In general, there are two phases to deploying a new version of an application: starting a set of processes with the new version and stopping the set of processes with the old version.</p>

<p>In Marathon, you can perform a rolling restart by defining an upgrade strategy with a <code class="highlighter-rouge">minimumHealthCapacity</code> at the application level.</p>

<p>The minimumHealthCapacity is a percentage which, when applied to the instance count, defines the number of healthy instances
that a certain version of the application must have at all times during update. Number of healthy instances is rounded up (ceil).</p>

<ul>
  <li><strong><code class="highlighter-rouge">minimumHealthCapacity</code> == 0</strong> : All old instances can be killed before the new version is deployed.</li>
  <li><strong><code class="highlighter-rouge">minimumHealthCapacity</code> == 1</strong> : All instances of the new version are deployed side by side before the old version is stopped.</li>
  <li><strong><code class="highlighter-rouge">minimumHealthCapacity</code> between 0 and 1</strong> : Scale the old version to minimumHealthCapacity and start the new version to minimumHealthCapacity side by side. If this is completed successfully, the new version is scaled to 100% and the old version is stopped. Number of healthy instances is rounded up (ceil). E.g. 3 instances and minimumHealthCapacity 0.7 gives us <code class="highlighter-rouge">⌈3 × 0.7⌉ = ⌈2.1⌉ = 3</code> so all instances will remain.</li>
</ul>

<p>This gets a bit more complex if there are dependencies.
In the example above, when the applications are updated, Marathon performs the following actions:</p>

<ol>
  <li>Upgrade application <em>db</em> until all instances are replaced, ready, and healthy (taking <code class="highlighter-rouge">upgradeStrategy</code> into account).</li>
  <li>Upgrade application <em>app</em> until all instances are replaced, ready, and healthy (taking <code class="highlighter-rouge">upgradeStrategy</code> into account).</li>
</ol>

<p><strong>Note:</strong> Your cluster needs to have more capacity available for the update process if you choose a <code class="highlighter-rouge">minimumHealthCapacity</code> greater than 0.5. When <code class="highlighter-rouge">minimumHealthCapacity</code> is greater than 0.5, more than half of the instances of the same application are run side by side.
These capacity constraints are added together if there are dependencies. In our example, we defined 0.6 for <em>db</em> and 0.8 for <em>app</em>. 
This means that when an update is performed there will be 12 instances of <em>db</em> (6 old and 6 new) and 32 instances of <em>app</em> (16 old and 16 new) running side by side.</p>

<h2 id="force-a-deployment">Force a Deployment</h2>

<p>An application can be changed by only one deployment at a time.
Other changes to the application must wait until the first deployment has finished.
You can break this rule by running a deployment with the force flag.
The REST interface allows the force flag for all state-changing operations.</p>

<p><strong>ATTENTION</strong>: The force flag should be used only in the case of a failed deployment!</p>

<p>If a force flag is set, all deployments that are affected by this deployment are cancelled.
This action may leave the system in an inconsistent state. Specifically, if a deployment is cancelled when an app is in the middle
of a rolling upgrade, it can end up in a state where some old and
some new tasks are running. If the new deployment does not update that app, it will stay in
that state until a future deployment is made for that app.</p>

<p>The only kind of deployments that can be force-updated safely are those that
affect single apps only. The only good reason to force a deployment that affects multiple apps is to correct
a failed deployment.</p>

<h2 id="a-failed-deployment">A failed Deployment</h2>

<p>A deployment consists of steps executed one after the other.
The next step is only executed if the previous step has finished successfully.</p>

<p>There are circumstances in which a step will never finish successfully. For example:</p>

<ul>
  <li>The new application does not start correctly.</li>
  <li>The new application does not become healthy.</li>
  <li>A dependency of the new application was not declared and is not available.</li>
  <li>The capacity of the cluster is exhausted.</li>
  <li>The app uses a Docker container and the configuration changes at <a href="https://mesosphere.github.io/marathon/docs/native-docker.html">Running Docker Containers on Marathon</a> were not made.</li>
</ul>

<p>The deployment in these cases would take forever.
To heal the system, a new deployment must be applied to correct the problem with the current deployment.</p>

<h2 id="the-v2deployments-endpoint">The /v2/deployments endpoint</h2>

<p>The list of running deployments can be accessed via the <a href="api-console/index.html">/v2/deployments</a> endpoint.
There are several items of information available for every deployment:</p>

<ul>
  <li><code class="highlighter-rouge">affectedApps</code>: Which applications are affected by this deployment.</li>
  <li><code class="highlighter-rouge">steps</code>: The steps to perform for this deployment.</li>
  <li><code class="highlighter-rouge">currentStep</code>: Which step is currently being performed.</li>
</ul>

<p>Every step can have several actions. The actions inside a step are performed concurrently.
Possible actions are:</p>

<ul>
  <li><code class="highlighter-rouge">StartApplication</code>: Start the specified application.</li>
  <li><code class="highlighter-rouge">StopApplication</code>: Stop the specified application.</li>
  <li><code class="highlighter-rouge">ScaleApplication</code>: Scale the specified application.</li>
  <li><code class="highlighter-rouge">RestartApplication</code>: Restart the specified application to the <code class="highlighter-rouge">minimumHealthStrategy</code>.</li>
  <li><code class="highlighter-rouge">KillAllOldTasksOf</code>: Kill the rest of tasks of the specified application.</li>
</ul>


    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2018 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>